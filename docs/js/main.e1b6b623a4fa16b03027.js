(self.webpackChunk=self.webpackChunk||[]).push([[179],{1880:(t,e,s)=>{"use strict";var r=s(7363),n=s(2444);const i={props:{modelValue:Array},template:'<div class="drop-target" ref="dropzone" @drop="drop" @dragover="dragover" @dragenter="dragenter" @dragleave="dragleave"><slot>Drop files here</slot></div>',methods:{files:function*(t){if(t.items)for(let e of t.items)yield e.getAsFile();else yield*t.files},drop:function(t){t.preventDefault(),this.$refs.dropzone.classList.remove("active");const e=Array.from(this.files(t.dataTransfer));this.$emit("update:modelValue",e)},dragenter:function(){this.$refs.dropzone.classList.add("active")},dragleave:function(){this.$refs.dropzone.classList.remove("active")},dragover:function(t){t.preventDefault()}}};var o=s(2845),a=s(6437);const l={components:{GithubButton:o.Z},data(){const t=Object.assign({},a.ce);return t.color_space=t.color_space.split(","),{support:{},available:{color_space:["G","RGB","CMYK","YCbCr","YCCK","LAB","HSV"]},option:t,files:[]}},template:'\n<div>\n\t<header class="lint-header">\n\t\t<h1 class="lint-title">image-lint</h1>\n\t\t<h2 class="lint-subtitle">Find broken or poorly compressed images.</h2>\n\n\t\t<github-button href="https://github.com/aaronasachimp/image-lint" data-size="large" data-show-count="true" aria-label="Star aaronasachimp/image-lint on GitHub">Star</github-button>\n\t</header>\n\t<form class="image-lint-app">\n\t\t<div class="pane pane-options">\n\t\t\t<h3 class="lint-options-title">Options</h3>\n\n\t\t\t<label class="lint-option lint-option-check">\n\t\t\t\t<input type="checkbox" v-model="option.mismatch" />\n\t\t\t\tFind mismatches between file type and file extension.\n\t\t\t</label>\n\n\t\t\t<label class="lint-option lint-option-check">\n\t\t\t\t<input type="checkbox" v-model="option.duplicate" />\n\t\t\t\tFind files that have been copied.\n\t\t\t</label>\n\t\t\t\n\t\t\t<label class="lint-option lint-option-number">\n\t\t\t\tSet the maximum bytes per pixel before giving a warning.\n\t\t\t\t<input type="number" v-model="option.bytes_per_pixel" step="0.1" min="0" />\n\t\t\t</label>\n\n\t\t\t<label class="lint-option lint-option-number">\n\t\t\t\tSet the minimum byte savings before giving a warning.\n\t\t\t\t<input type="number" v-model="option.byte_savings" min="0" />\n\t\t\t</label>\n\n\t\t\t<label class="lint-option lint-option-array">\n\t\t\t\tSet the allowed color spaces.\n\n\t\t\t\t<vue-multiselect v-model="option.color_space" :multiple="true" :options="available.color_space" />\n\t\t\t</label>\n\t\t</div>\n\t\t<div class="pane pane-dropzone">\n\t\t\t<dropzone v-model="files" :class="{ empty: files.length == 0 }">\n\t\t\t\t<div v-if="files.length">\n\t\t\t\t\t<button type="button" v-on:click="clear">Clear Results</button>\n\t\t\t\t\t<image-collection :options="option" :files="files"></image-collection>\n\t\t\t\t</div>\n\t\t\t</dropzone>\n\t\t</div>\n\t</form>\n</div>\n',methods:{clear:function(){this.files.length=0}}},c=new a.XC(a.qF.get_all_extensions(),a.qF.get_all_mimes()),h={props:["options","files"],data:()=>({linter:null,error:null,results:null}),template:'\n<ul class="lint-results">\n\t<li v-for="result in results" class="lint-result" v-bind:class="{ \'has-error\': has_error, \'has-results\': has_results }">\n\t\t<details open>\n\t\t\t<summary class="lint-result-summary" v-bind:class="{ \'lint-error\': result && result.count.error, \'lint-warn\': result && result.count.warn }">\n\t\t\t\t{{ result.filename }}\n\t\t\t\t<span v-if="has_results"> - \n\t\t\t\t\t<span v-if="result.count.info">Info: {{ result.count.info }}<span v-if="result.count.warn || result.count.error">, </span></span>\n\t\t\t\t\t<span v-if="result.count.warn">Warnings: {{ result.count.warn }}<span v-if="result.count.error">, </span></span>\n\t\t\t\t\t<span v-if="result.count.error">Errors: {{ result.count.error }}</span>\n\t\t\t\t</span>\n\t\t\t</summary>\n\t\t\t<output class="lint-result-output" v-if="has_results" v-html="reformat_log(result.log)"></output>\n\t\t</details>\n\t</li>\n</ul>',watch:{files:{async handler(t,e){let s=this.options,r=null,n=new a.r3(c);try{r=await new Promise(((e,r)=>{let i=[];n.lint(t,s).on("file.completed",(t=>{i.push(t)})).on("linter.completed",(()=>{e(i)}))}))}catch(t){return void(this.error=t)}this.results=r},immediate:!0}},computed:{has_finished(){return null!==this.results||null!==this.error},has_error(){return null!==this.error},has_results(){return null!==this.results}},methods:{reformat_log:t=>t.trim().split("\n").map((t=>t.trim())).join("\n")}},_=document.body,d=document.createElement("div"),u=document.createElement("image-lint-app");d.appendChild(u),_.appendChild(d),(0,r.ri)({}).component("vue-multiselect",n.ZP).component("dropzone",i).component("image-lint-app",l).component("image-collection",h).mount(d)},6437:(t,e,s)=>{const r=s(5194),n=s(7350),i=s(8886),o=(s(3789),s(9302)),a=s(8474);e.r3=r.default,e.ce=n.default,i.default,e.qF=o,e.XC=a},8886:(t,e,s)=>{t.exports={default:class{static argv(t,e){return e.help?this.help(t):!!e.version&&this.version(t)}static load_package_info(){return s(991)}static print_option(t,e,s){let r=[e],n="",i="";if(t.alias&&e in t.alias){const s=t.alias[e];Array.isArray(s)?r=r.concat(s):r.push(s)}n=r.map((t=>{let e="";return t.length>1?e+="--"+t:1==t.length&&(e+="-"+t),e})).join(", "),t.default&&e in t.default&&(i=" Default: "+t.default[e].toString()),console.log("  "+n+"\t"+s+i)}static help(t){const e=this.load_package_info();if(console.log(`${e.name} - ${e.description}`),console.log(`\nUsage: ${t["-help-usage"]}`),console.log("\nOptions: "),"-help-options"in t)for(const e in t["-help-options"])if(t["-help-options"].hasOwnProperty(e)){const s=t["-help-options"][e];this.print_option(t,e,s)}return!0}static version(t){const e=this.load_package_info();return console.log(e.name+" v"+e.version),!0}}}},7350:t=>{t.exports={default:{bytes_per_pixel:3,byte_savings:500,color_space:"G,RGB",mismatch:!0,duplicate:!0}}},8953:(t,e,s)=>{"use strict";s(343),t.exports=class{constructor(t,e){this.extensions=t,this.mimes=e}get_files(t){throw new Error("Not Implemented")}is_image_extension(t){return this.extensions.indexOf(t)>=0}is_image_mime(t){return this.mimes.indexOf(t)>=0}}},8474:(t,e,s)=>{const r=s(8953),n=s(5342),i=s(7425);t.exports=class extends r{get_files(t){return Promise.resolve(this._search.bind(this,t))}*_search(t){for(const e of t){const t=i.extname(e.name);yield{path:e.name,extension:t,loader:new n(e)}}}}},3632:(t,e,s)=>{"use strict";const r=s(2337);t.exports=class{constructor(){this.trie=new Map}find(t){let e=this.trie,s=0;for(;s<=3;){const r=e,n=t[s];e=e.get(n),e||(e=new Map,r.set(n,e)),s++}return e}contains(t,e){const s=r.createHash("sha1");s.update(e);const n=s.digest("binary"),i=this.find(n),o=i.get(n);return o||i.set(n,t),o}}},9302:t=>{class e{constructor(){this._info_provider=null}identify_only(){return!this.get_info_provider()}is_of_file_type(t){throw new Error("Not Implemented")}get_extension(){return this.get_extensions()[0]}get_extensions(){throw new Error("Not Implemented")}get_mime(){return this.get_mimes()[0]}get_mimes(){throw new Error("Not Implemented")}can_validate(t){return!1}get_info_provider(){return null}static register(t){const e=new t,s=e.identify_only();for(const t of e.get_extensions())this._extension_registry.set(t,e),s||this._all_extensions.push(t);for(const t of e.get_mimes())this._mime_registry.set(t,e),s||this._all_mimes.push(t);this._all_providers.push(e)}static clear_registry(){this._extension_registry.clear(),this._all_extensions.length=0,this._mime_registry.clear(),this._all_mimes.length=0,this._all_providers.length=0}static get_all_extensions(){return e._all_extensions}static get_all_mimes(){return e._all_mimes}static from_extension(t){return e._extension_registry.get(t)}static*all_providers(){yield*e._all_providers}}e._extension_registry=new Map,e._mime_registry=new Map,e._all_providers=[],e._all_extensions=[],e._all_mimes=[],t.exports=e},7459:(t,e,s)=>{var r=s(816).Buffer;const n=s(9302),i=s(2645);n.register(class extends i{get_magic(){return r.from("424D","hex")}get_extensions(){return[".bmp"]}get_mimes(){return["image/bmp","image/x-bmp"]}})},8329:(t,e,s)=>{var r=s(816).Buffer;const n=s(9302),i=s(2645),o=s(2359);n.register(class extends i{get_magic(){return r.from("GIF")}get_extensions(){return[".gif"]}get_mimes(){return["image/gif"]}get_info_provider(){return o}})},2968:(t,e,s)=>{const r=s(9302),n=s(7559);r.register(class extends n{get_root_element(){return"html"}get_extensions(){return[".html",".htm",".xhtml"]}get_mimes(){return["text/html","application/xhtml+xml"]}})},725:(t,e,s)=>{const r=s(9302);r.register(class extends r{can_validate(t){return t.length>4}is_of_file_type(t){const e=t.readUInt16LE(0),s=t.readUInt16LE(2);return 0===e&&(1===s||2===s)}get_extensions(){return[".ico",".cur"]}get_mimes(){return["image/x-icon"]}})},1356:(t,e,s)=>{var r=s(816).Buffer;const n=s(9302),i=s(2645),o=s(66);n.register(class extends i{get_magic(){return r.from("ffd8ff","hex")}get_extensions(){return[".jpg",".jpeg",".jpe"]}get_mimes(){return["image/jpeg"]}get_info_provider(){return o}})},5569:(t,e,s)=>{var r=s(816).Buffer;const n=s(9302),i=s(2645),o=s(6966);n.register(class extends i{get_magic(){return r.from("ff0a","hex")}get_extensions(){return[".jxl"]}get_mimes(){return["image/jxl"]}get_info_provider(){return o}})},2645:(t,e,s)=>{var r=s(816).Buffer;const n=s(9302);t.exports=class extends n{get_magic(){throw new Error("Not Implemented")}is_of_file_type(t){const e=this.get_magic(),s=t.slice(0,e.length);return 0===r.compare(e,s)}can_validate(t){const e=this.get_magic();return t.length>=e.length}}},4675:(t,e,s)=>{var r=s(816).Buffer;const n=s(9302),i=s(2645),o=s(2143);n.register(class extends i{get_magic(){return r.from("89504e470d0a1a0a","hex")}get_extensions(){return[".png"]}get_mimes(){return["image/png"]}get_info_provider(){return o}})},5142:(t,e,s)=>{var r=s(816).Buffer;const n=s(9302),i=s(2645);n.register(class extends i{get_magic(){return r.from("38425053","hex")}get_extensions(){return[".psd"]}get_mimes(){return["image/photoshop","image/x-photoshop","image/psd"]}})},7306:(t,e,s)=>{"use strict";const r=s(9302);t.exports=class extends r{get_type_tag(){throw new Error("Not Implemented!")}can_validate(t){return t.length>12}is_of_file_type(t){const e=t.readUInt32BE(0),s=t.readUInt32BE(8);return 1380533830===e&&s===this.get_type_tag()}}},2728:(t,e,s)=>{const r=s(9302),n=s(7559);r.register(class extends n{get_root_element(){return"svg"}get_extensions(){return[".svg"]}get_mimes(){return["image/svg+xml"]}})},5145:(t,e,s)=>{var r=s(816).Buffer;const n=s(9302),i=s(2645);n.register(class extends i{get_magic(){return r.from([73,73,42,0])}get_extensions(){return[".tif",".tiff"]}get_mimes(){return["image/tiff","image/tiff-fx"]}})},4869:(t,e,s)=>{"use strict";const r=s(9302),n=s(7306);r.register(class extends n{get_type_tag(){return 1464156752}get_extensions(){return[".webp"]}get_mimes(){return["image/webp"]}})},7559:(t,e,s)=>{const r=s(9302);t.exports=class extends r{get_root_element(){throw new Error("Not Implemented!")}is_of_file_type(t){return t.slice(0,512).toString().toLowerCase().includes("<"+this.get_root_element())}can_validate(t){return!0}}},3789:t=>{"use strict";t.exports=class{calculate_bpp(t,e){return(e-this.get_overhead())/(t.width*t.height*t.frames)}get_overhead(){return 0}get_dimensions(t){throw new Error("Not Implemented")}get_pixel_format(t){throw new Error("Not Implemented")}get_info(t){const e={truncated:this.is_truncated(t)};if(!e.truncated){const s=this.get_dimensions(t);e.dimensions=s,e.size=t.length,e.pixel_format=this.get_pixel_format(t),e.bytes_per_pixel=this.calculate_bpp(s,t.length)}return e}is_truncated(t){throw new Error("Not Implemented")}}},2359:(t,e,s)=>{"use strict";const r=s(3789),n=s(5464),i=n.PixelFormat,o=n.ColorSpace;t.exports=class extends r{get_overhead(){return 35}next_chunk(t,e){const s=2+t.readUInt8(e+2);return e+s+this.get_sub_block_length(t,e+s+1)+1}get_sub_block_length(t,e){let s=0,r=t.readUInt8(e);if(0!==r)for(;0!==r;)r=t.readUInt8(e+s),s+=r+1;else s=1;return s}get_color_table_length(t,e){const s=7&t.readUInt8(e);return 3*Math.pow(2,s+1)}has_color_table(t,e){return!!(128&t.readUInt8(e))}get_version(t){return t.toString("ascii",3,6)}get_dimensions(t){let e=0,s=!1,r=0;for(r=this.has_color_table(t,10)?13+this.get_color_table_length(t,10):13;!s;){let n=t.readUInt8(r);44===n&&(e++,r+=9,this.has_color_table(t,r)&&(r+=this.get_color_table_length(t,r)),r+=2,r+=this.get_sub_block_length(t,r)),r+1>=t.length?s=!0:(n=t.readUInt8(r),33===n||44===n?r=this.next_chunk(t,r):s=!0)}return{width:t.readUInt16LE(6),height:t.readUInt16LE(8),frames:e}}is_truncated(t){return 59!==t.readUInt8(t.length-1)}get_pixel_format(){const t=new i;return t.color_space=o.RGB,t.indexed=!0,t.bit_depth.R=8,t.bit_depth.G=8,t.bit_depth.B=8,t.bit_depth.alpha=1,t}}},66:(t,e,s)=>{"use strict";const r=s(3789),n=s(5464),i=n.PixelFormat,o=n.ColorSpace;t.exports=class extends r{next_chunk(t,e){return e+2+t.readUInt16BE(e+2)}is_sof_chunk(t,e){const s=t.readUInt8(e+1);return 192==(240&s)&&196!==s&&200!==s&&204!==s}*chunks(t){let e=this.next_chunk(t,2),s=!1;for(;!s;)yield e,e=this.next_chunk(t,e),e>t.length&&(s=!0)}get_overhead(){return 119}is_truncated(t){return 65497!==t.readUInt16BE(t.length-2)}get_dimensions(t){let e=null,s=null;for(const r of this.chunks(t))if(this.is_sof_chunk(t,r)){e=t.readUInt16BE(r+7),s=t.readUInt16BE(r+5);break}if(!e||!s)throw new Error("Dimensions not found");return{width:e,height:s,frames:1}}get_pixel_format(t){const e=new i;let s=null;for(const e of this.chunks(t))if(this.is_sof_chunk(t,e)){s=t.readUInt8(e+9);break}return 1===s?e.color_space=o.G:3===s?e.color_space=o.RGB:4===s&&(e.color_space=o.CMYK),e}}},6966:(t,e,s)=>{"use strict";const r=s(3789),n=s(5464),i=n.PixelFormat,o=n.ColorSpace,{BitStream:a}=s(8397),{SizeHeader:l}=s(4800),{ImageMetadata:c}=s(6014),{COLOR_SPACE:h}=s(2592);t.exports=class extends r{get_overhead(){return 119}is_truncated(t){return 0!==t.readUInt8(t.length-1)}get_dimensions(t){const e=new a(t,0),s=new l(e);return{width:s.get_xsize(),height:s.get_ysize(),frames:1}}get_pixel_format(t){const e=new a(t,0),s=new c(e).color_encoding,r=new i;if(s)if(s.color_space===h.K_GREY)r.color_space=o.G;else if(s.color_space===h.K_RGB)r.color_space=o.RGB;else if(s.color_space===h.K_XYZ)r.color_space=o.XYZ;else{if(s.color_space!==h.K_XYB)throw new Error("Unknown color space.");r.color_space=o.XYB}return r}}},8397:t=>{const e=4294967295;class s extends Error{}t.exports={BitStream:class{constructor(t,e=0){this.buffer=t,this.offset=e,this.sub_bit=0,this.current_byte=t.readUInt8(e)}read_from_byte(t,e,s){let r=t,n=(1<<s)-1;return n=n<<e>>>0,r=(r&n)>>>e,r}read_bits(t){if(t>32)throw new Error(`Can not read more than 32 bits at a time. Attempting to read ${t}`);if(0===t)return 0;let e=0,s=0;const r=8-this.sub_bit;this.sub_bit>0&&t>r&&(t-=r,e=this.read_from_byte(this.current_byte,this.sub_bit,r),s=r,this.offset+=1,this.current_byte=this.buffer.readUInt8(this.offset),this.sub_bit=0);const n=Math.floor(t/8);let i=e;if(n>0){for(let t=0;t<n;t++){let t=this.read_from_byte(this.current_byte,0,8);s&&(t<<=s),this.offset+=1,this.current_byte=this.buffer.readUInt8(this.offset),s+=8,i|=t}this.sub_bit=0}if((t-=8*n)>0){let e=this.read_from_byte(this.current_byte,this.sub_bit,t);s&&(e<<=s),i|=e,this.sub_bit+=t}return i}read_boolean(){return!!this.read_bits(1)}read_u32(...t){if(t.length>4)throw new Error("U32: A u32 takes only 4 distributions.");const s=t[this.read_bits(2)];if(0===s[0])return s[1];if(1===s[0])return this.read_bits(s[1]);if(2===s[0]){if(3!==s.length)throw new Error("U32: incorrect number of parameters for BitsOffset distribution.");return(s[2]+this.read_bits(s[1]))%e}throw new Error("U32: Unknown distribution.")}read_s32(...t){let s=this.read_u32(...t);return s%2==0?s>>1:s===e?2147483648:-(s>>1)}read_f16(){const t=this.read_bits(16),e=t>>15,r=t>>10&31,n=1023&t;let i;if(31===r)throw new s("F16: Invalid biased exponent.");if(0==r)i=n/(1<<24);else{const t=r+112,s=n<<13,o=new ArrayBuffer(4);new Uint32Array(o)[0]=e<<31|t<<23|s,i=new Float32Array(o)[0]}return i}read_customxy(){return{x:this.read_s32([1,19],[2,19,524288],[2,20,1048576],[2,21,2097152]),y:this.read_s32([1,19],[2,19,524288],[2,20,1048576],[2,21,2097152])}}read_enum(t){const e=this.read_u32([0,0],[0,1],[2,4,2],[2,6,18]);if(e>63)throw new s(`Enum: Invalid value: ${e}`);if(!t.has(e))throw new s(`Enum: Unknown value: ${e}`);return e}get_bits_read(){return 8*this.offset+this.sub_bit}},IllformedStreamError:s,U32:{VAL:0,BITS:1,BITS_OFFSET:2}}},2592:t=>{const e={K_RGB:0,K_GREY:1,K_XYB:2,K_UNKNOWN:3,K_XYZ:4},s=new Set;s.add(e.K_RGB),s.add(e.K_GREY),s.add(e.K_XYB),s.add(e.K_UNKNOWN),s.add(e.K_XYZ);const r=new Set;r.add(1),r.add(2),r.add(10),r.add(11);const n=new Set;n.add(1),n.add(2),n.add(9),n.add(11);const i=new Set;i.add(1),i.add(2),i.add(8),i.add(13),i.add(16),i.add(17),i.add(18);const o=new Set;o.add(0),o.add(1),o.add(2),o.add(3),t.exports={ColorEncoding:class{constructor(t){if(this.received_icc=!1,this.opaque_icc=!1,this.color_space=e.K_RGB,this.white_point=1,this.primaries=1,this.have_gamma=!1,this.gamma=0,this.transfer_function=13,this.rendering_intent=1,t){const a=t.read_boolean();a||(this.received_icc=t.read_boolean(),this.received_icc?this.opaque_icc=t.read_boolean():this.opaque_icc=!1,a||this.opaque_icc||(this.color_space=t.read_enum(s),this.color_space!==e.K_XYB&&this.color_space!==e.K_XYZ&&(this.white_point=t.read_enum(r),2===this.white_point&&(this.white=t.read_customxy()),this.color_space!==e.K_GREY&&(this.primaries=t.read_enum(n),2===this.primaries&&(this.red=t.read_customxy(),this.green=t.read_customxy(),this.blue=t.read_customxy())),this.have_gamma=t.read_boolean(),this.have_gamma?this.gamma=t.read_bits(24):this.transfer_function=t.read_enum(i),this.color_space!==e.K_GREY&&(this.rendering_intent=t.read_enum(o)))))}}},COLOR_SPACE:e}},6014:(t,e,s)=>{const{U32:r}=s(8397),{ColorEncoding:n}=s(2592);t.exports={ImageMetadata:class{constructor(t){t.read_boolean()?(this.have_icc=!1,this.bits_per_sample=8,this.color_encoding=new n,this.alpha_bits=0,this.target_nits=250,this.m2=null):(this.have_icc=t.read_boolean(),this.bits_per_sample=t.read_u32([r.VAL,8],[r.VAL,16],[r.VAL,32],[r.BITS,5]),this.color_encoding=new n(t),this.alpha_bits=t.read_u32([r.VAL,0],[r.VAL,8],[r.VAL,16],[r.BITS,4]),this.target_nits=t.read_u32([r.VAL,5],[r.VAL,20],[r.VAL,80],[r.BITS_OFFSET,10,1]),this.m2=null)}}}},4800:(t,e,s)=>{const{U32:r}=s(8397);t.exports={SizeHeader:class{constructor(t){let e,s;if(this.small=t.read_boolean(),e=this.small?8*(t.read_bits(5)+1):t.read_u32([r.BITS,9],[r.BITS,13],[r.BITS,18],[r.BITS,30])+1,this.ratio=t.read_bits(3),0===this.ratio)s=this.small?8*(t.read_bits(5)+1):t.read_u32([r.BITS,9],[r.BITS,13],[r.BITS,18],[r.BITS,30])+1;else if(1===this.ratio)s=e;else if(2===this.ratio)s=Math.floor(12*e/10);else if(3===this.ratio)s=Math.floor(4*e/3);else if(4===this.ratio)s=Math.floor(3*e/2);else if(5===this.ratio)s=Math.floor(16*e/9);else if(6===this.ratio)s=Math.floor(5*e/4);else{if(7!==this.ratio)throw new Error("SizeHeader: unknown aspect ratio.");s=Math.floor(2*e/1)}this.ysize=e,this.xsize=s}get_small(){return this.small}get_ysize(){return this.ysize}get_xsize(){return this.xsize}get_ratio(){return this.ratio}},Ratio:{XSIZE_SEPARATE:0,XSIZE_IS_YSIZE:1,XSIZE_RATIO_12X10:2,XSIZE_RATIO_4X3:3,XSIZE_RATIO_3X2:4,XSIZE_RATIO_16X9:5,XSIZE_RATIO_5X4:6,XSIZE_RATIO_2X1:7}}},2143:(t,e,s)=>{"use strict";var r=s(816).Buffer;const n=s(1461),i=s(3789),o=s(5464),a=o.PixelFormat,l=o.ColorSpace,c=new Set([0,4]),h=new Set([2,3,6]),_=new Set([4,6]),d=new Set([4]);class u{constructor(t,e){this.length=t.readUInt32BE(e),this.header=t.readUInt32BE(e+4),this.data=t.slice(e+4+4,this.length),this.crc32=t.readUInt32BE(e+4+4+this.length)}verify(){const t=r.alloc(4);let e=null;return t.writeUInt32BE(this.header,0),e=n.crc32(t),e=n.crc32(this.data,e),e===this.crc32}}t.exports=class extends i{get_overhead(){return 67}is_truncated(t){let e=null;try{e=new u(t,t.length-12)}catch(t){return!0}return 1229278788===e.header&&!e.verify()}get_dimensions(t){return{width:t.readUInt32BE(16),height:t.readUInt32BE(20),frames:1}}get_pixel_format(t){const e=new a,s=t.readInt8(24),r=t.readInt8(25);if(h.has(r))e.color_space=l.RGB,e.bit_depth.R=s,e.bit_depth.G=s,e.bit_depth.B=s;else{if(!c.has(r))throw new Error("Unknown color type "+r);e.color_space=l.G,e.bit_depth.G=s}return _.has(r)&&(e.alpha=!0,e.bit_depth.alpha=s),d.has(r)&&(e.indexed=!0),e}}},5194:(t,e,s)=>{var r=s(816).Buffer;const n=s(8272),i=s(3632),o=s(5464).ColorSpace,a=s(9173).m,l=s(343),c=s(9302);s(4675),s(8329),s(1356),s(5569),s(7459),s(5142),s(725),s(5145),s(4869),s(2728),s(2968),t.exports.default=class extends l{constructor(t){super(),this.finder=t,this.disable_color=!1}calculate_optimial_size(t,e){return t.width*t.height*t.frames*e}describe_file(t){return"File properties: "+t.width+"x"+t.height+(1!==t.frames?", "+t.frames+" frames":"")}get_info(t,e,s,n){return new Promise(((i,o)=>{const a=t.extension.toLowerCase();let l=c.from_extension(a),h=null,_=!1;if(e instanceof r){if(h=e,l?_=l.is_of_file_type(h):s.warn('There is no information provider for "'+a+'" files.'),!l||!_){!0===n.mismatch?s.info("This file is not what it seems, attempting brute force discovery of file type."):s.info("This file is not what it seems."),l=null;for(const t of c.all_providers())t.can_validate(h)&&t.is_of_file_type(h)&&(l=t)}if(!_){let t="unknown";l&&(t=l.get_extension()),!0===n.mismatch&&s.warn("There is a mismatch between the file extension ("+a+") and the file contents ("+t+")")}if(l){const t=l.get_info_provider();t?i((new t).get_info(h)):o("Unsupported file type")}else o("Unknown file type")}else o("Image buffer is missing, this is a bug.")}))}lint(t,e){const s=this,r=new n,l=new i;let c=null;if(e.color_space){const t=e.color_space;c=new Set;for(let e of t)e=o.from(e),e&&c.add(e)}return r.on("next",((t,r)=>{const n=a.get_log(t.path);function i(t){t.stack?n.error(t.message+": "+t.stack):n.error(t),s.emit("file.completed",n),r()}t.loader.load().then((s=>{if(0===s.length)throw"This is an empty file, further analysis is not possible.";if(!0===e.duplicate){const e=l.contains(t.path,s);e&&n.warn("This file is a duplicate of: "+e)}return this.get_info(t,s,n,e)})).then((t=>{if(t.truncated)n.error("This image is truncated, further analysis is not possible.");else{const s=t.pixel_format.color_space,r=e.bytes_per_pixel,i=e.byte_savings,o=t.size-this.calculate_optimial_size(t.dimensions,r);n.info(this.describe_file(t.dimensions)),t.bytes_per_pixel>=r&&o>i&&(n.warn("The bytes per pixel ("+t.bytes_per_pixel.toFixed(2)+") exceeds the minimum ("+r+")."),n.info("You can acheive a minimum savings of "+o+" bytes by meeting this threshold.")),c&&c.size&&!c.has(s)&&n.warn(`The color space of this image is ${s.name}. It must be one of ${e.color_space}.`)}this.emit("file.completed",n),r()}),i).catch(i)})),r.on("end",(()=>{this.emit("linter.completed")})),r.start(this.finder.get_files(t)),this}}},372:t=>{t.exports=class{constructor(t){this._path=t}getPath(){return this._path}load(){return Promise.reject("Not Implemented!")}}},5342:(t,e,s)=>{var r=s(816).Buffer;const n=s(372);t.exports=class extends n{constructor(t){super(""),this._blob=t}async load(){const t=await this._blob.arrayBuffer();return r.from(t)}}},9173:(t,e,s)=>{"use strict";const r=s(5479);class n{constructor(t){this.filename=t,this.log="",this.count={info:0,warn:0,error:0}}is_printable(){return this.count.warn>0||this.count.error>0}info(t){this.count.info++,this.log+="\n  INFO:  "+t}warn(t){this.count.warn++,this.log+="\n  "+r.yellow("WARN:")+"  "+t}error(t){this.count.error++,this.log+="\n  "+r.red("ERROR:")+"  "+t}toString(){let t=this.count.warn.toString(),e=this.count.error.toString();return this.count.warn&&(t=r.yellow(t)),this.count.error&&(e=r.red(e)),this.filename+this.log+"\n"+t+" warnings. "+e+" errors."}}e.m=class{static get_log(t){return new n(t)}}},5464:t=>{"use strict";class e{constructor(t,s){this.name=t,this.channels=s,e.all_names.add(t)}static from(t){let s=null;return this.all_names.has(t)&&(s=e[t]),s}}e.all_names=new Set,e.G=new e("G",1),e.RGB=new e("RGB",3),e.YCbCr=new e("YCbCr",3),e.YCCK=new e("YCCK",4),e.LAB=new e("LAB",3),e.HSV=new e("HSV",3),e.CMYK=new e("CMYK",4),e.XYZ=new e("XYZ",3),e.XYB=new e("XYB",3),t.exports={ColorSpace:e,PixelFormat:class{constructor(){this.indexed=!1,this.alpha=!1,this.bit_depth={}}}}},8272:(t,e,s)=>{"use strict";const r=s(343);t.exports=class extends r{constructor(){super(),this._active_handlers=0,this._active_processes=0,this._done_proxy=this._done.bind(this),this._iterator=null,this.on("handler.available",this._handler_available.bind(this))}_handler_available(){if(this._iterator){const t=this._iterator.next();t.done?this._iterator=null:(this.emit("next",t.value,this._done_proxy),this._active_handlers++,this._active_processes++)}}_done(){if(this._active_handlers--,this._active_processes--,!(this._active_handlers>=0))throw new Error("No handlers available, did you call done?");this.emit("handler.available"),this._active_processes<=0&&this.emit("end")}start(t){if(this._iterator)throw new Error("Work is in progress");this._active_handlers=0,t.then((t=>{for(this._iterator=t();this._active_handlers<10;)this.emit("handler.available"),this._active_handlers++}),(t=>{t.stack?console.error(`${t.name}: ${t.message} \n`,t):console.error("Error",t)})).catch((t=>{t.stack?console.error(`${t.name}: ${t.message} \n`,t):console.error("Error",t)}))}}},2909:()=>{},5545:()=>{},6047:()=>{},4215:()=>{},7021:()=>{},6611:()=>{},1212:()=>{},303:()=>{},4318:()=>{},3967:()=>{},7523:()=>{},4282:()=>{},3927:()=>{},7702:()=>{},991:t=>{"use strict";t.exports=JSON.parse('{"name":"image-lint","version":"2.1.1","description":"Find files that are incorrectly named or compressed.","main":"lib/api.js","repository":"github:AaronAsAChimp/image-lint","directories":{"test":"test"},"bin":{"image-lint":"bin/image-lint.js"},"scripts":{"test":"jest","prepack":"cp ../README.md ."},"keywords":["cli","image","lint","compression"],"author":"Aaron Spaulding","license":"MIT","dependencies":{"chalk":"^4.1.0","crc":"^3.8.0","got":"^11.8.2","minimist":"^1.2.5","puppeteer":"^13.5.1","tmp":"0.0.33"},"devDependencies":{"eslint":"^8.9.0","eslint-config-google":"^0.14.0","flow-bin":"^0.171.0","jest":"^26.6.3"},"jest":{"rootDir":"lib"}}')}},t=>{t.O(0,[216],(()=>(1880,t(t.s=1880)))),t.O()}]);
//# sourceMappingURL=main.e1b6b623a4fa16b03027.js.map